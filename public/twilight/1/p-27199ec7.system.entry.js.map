{"version":3,"names":["sallaPriceRangeCss","SallaPriceRange","exports","this","filterValues","setTimeout","class_1","prototype","connectedCallback","_this","filtersData","_a","price","minPrice","min","maxPrice","max","salla","lang","onLoaded","moreThanLabel","getWithDefault","lessThanLabel","toLabel","fromLabel","option","values","length","chunkSize","Math","ceil","i","push","slice","reduce","final","currentValue","to","count","reset","minInput","value","maxInput","getPriceLabel","filterValue","isNaN","from","concat","money","handleMinMaxPrice","event","changedEventHandler","isMin","typing","helpers","inputDigitsOnly","target","clearTimeout","debounce","minInputValidation","maxInputValidation","isReady","changed","emit","isChecked","isMinEqual","isMaxEqual","render","h","Host","map","index","class","htmlFor","key","id","name","type","checked","onChange","e","config","currency","symbol","maxlength","ref","el","onInput","placeholder","componentDidLoad"],"sources":["src/components/salla-price-range/salla-price-range.scss?tag=salla-price-range","src/components/salla-price-range/salla-price-range.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n\n.rtl, [dir=\"rtl\"] {\n  .rtl-range-slider {\n      transform: rotateY(180deg);\n  }\n\n  .rtl-range-numbers{\n      flex-direction: row-reverse;\n  }\n\n  .form-select, select{\n      background-position: left 0.5rem center;\n      padding-right: 12px;\n  }   \n\n  // divide\n.menu-divide {\n  li {\n      &:not(:last-child) {\n          &:after {\n              left: 0;\n              right: auto;\n          }\n      }\n  }\n}\n}\n\ninput[type=range]::-webkit-slider-thumb {\n  pointer-events: all;\n  width: 24px;\n  height: 24px;\n  -webkit-appearance: none;\n}\n\n[type='checkbox']:checked{\n  background-size: 80%;\n}","import { Component, Host, h, State, Prop, Event, Method } from '@stencil/core';\nimport { Filter, FilterValue } from \"../salla-filters/interfaces\";\n\n@Component({\n  tag: 'salla-price-range',\n  styleUrl: 'salla-price-range.scss',\n})\nexport class SallaPriceRange {\n  /**\n   * Minimum price threshold value\n   */\n  @Prop({ mutable: true }) minPrice;\n\n  /**\n   * Maximum price threshold value\n   */\n  @Prop({ mutable: true }) maxPrice;\n\n  /**\n   * Product price range filter option object instance\n   */\n  @Prop({ reflect: true }) option: Filter;\n\n  /**\n   * Currently selected price filter data\n   */\n  @Prop({ reflect: true }) filtersData: any;\n\n\n  @State() min = 0;\n  @State() max = 10000;\n  @State() priceOptions: any;\n  @State() moreThanLabel: string = \"أكثر من\";\n  @State() lessThanLabel: string = \"أقل من\";\n  @State() toLabel: string = \"الى\";\n  @State() fromLabel: string = \"من\";\n  @State() typing: boolean = false;\n  @State() debounce: ReturnType<typeof setTimeout> = setTimeout(() => '', 1000);\n  /**\n   * Custome event emitted when there is a change in price input.\n   */\n  @Event() changed: any;\n\n  isReady: Boolean;\n  minInput: HTMLInputElement;\n  maxInput: HTMLInputElement;\n  filterValues: Array<FilterValue> = [];\n\n\n  connectedCallback() {\n    if (this.filtersData && this.filtersData?.price) {\n      this.minPrice = this.filtersData.price.min;\n      this.maxPrice = this.filtersData.price.max;\n    }\n    salla.lang.onLoaded(() => {\n      this.moreThanLabel = salla.lang.getWithDefault('common.elements.more_than', this.moreThanLabel)\n      this.lessThanLabel = salla.lang.getWithDefault('common.elements.less_than', this.lessThanLabel)\n      this.toLabel = salla.lang.getWithDefault('common.elements.to', this.toLabel)\n      this.fromLabel = salla.lang.getWithDefault('common.elements.from', this.fromLabel)\n    })\n\n    //no need to show one option only\n    if (this.option.values.length == 1) {\n      return;\n    }\n    //here we may receive too many prices, we will group all inputs to\n    if (this.option.values.length <= 5) {\n      this.filterValues = this.option.values;\n      return;\n    }\n    const chunkSize = Math.ceil(this.option.values.length / 5);\n    for (let i = 0; i < this.option.values.length; i += chunkSize) {\n      this.filterValues.push(\n        this.option.values\n          .slice(i, i + chunkSize)\n          .reduce((final: FilterValue, currentValue: FilterValue) => {\n            final.to = currentValue.to;\n            final.count += currentValue.count;\n            return final;\n          })\n      );\n      // do whatever\n    }\n  }\n\n  /**\n   * reset the price range inputs\n   */\n  @Method()\n  async reset() {\n    //@ts-ignore\n    this.minInput.value = null;\n    this.maxInput.value = null;\n  }\n\n  private getPriceLabel(filterValue: FilterValue) {\n    // @ts-ignore\n    if (isNaN(filterValue.from) || filterValue.from < 1) {\n      return `${this.lessThanLabel} ${salla.money(filterValue.to)}`;\n    }\n    // @ts-ignore\n    if (isNaN(filterValue.to) || filterValue.to < 1) {\n      return `${this.moreThanLabel} ${salla.money(filterValue.from)}`;\n    }\n\n    return `${salla.money(filterValue.from)} ${this.toLabel} ${salla.money(filterValue.to)}`;\n  }\n\n  private handleMinMaxPrice(event: Event, value: FilterValue): void {\n\n    //todo:: cover when from is star\n    this.minPrice = value.from;\n    this.maxPrice = value.to != '*' ? value.to : \"\";\n\n    this.changedEventHandler(event);\n  }\n\n  private async changedEventHandler(event, isMin = false) {\n    this.typing = true;\n    salla.helpers.inputDigitsOnly(event.target)\n    let value = event ? event.target.value * 1 : \"\"\n    clearTimeout(this.debounce)\n    this.debounce = setTimeout(() => {\n      this.typing = false\n      if (isMin) {\n        if (!this.maxPrice && value) {\n          this.maxPrice = '';\n        }\n        this.minInputValidation(value);\n      } else {\n        if (!this.minPrice && value) {\n          this.minPrice = 0;\n        }\n        this.maxInputValidation(value)\n      }\n\n      this.isReady && this.changed.emit({\n        event: event,\n        option: this.option,\n        value: { max: this.maxPrice, min: this.minPrice }\n      })\n\n    }, 1000)\n  }\n\n\n  minInputValidation(value) {\n    if (value && (value > this.max || (this.maxPrice && value > this.maxPrice))) {\n      // this.minPrice = this.maxPrice;\n      return;\n    }\n\n    if (value < this.min) {\n      this.minPrice = this.min;\n      return;\n    }\n\n    if (value) {\n      this.minPrice = value;\n    }\n  }\n\n  maxInputValidation(value) {\n    if (value && (value < this.min || (this.minPrice && value < this.minPrice))) {\n      // this.maxPrice = this.minPrice;\n      return;\n    }\n    if (value > this.max) {\n      this.maxPrice = this.max;\n      return;\n    }\n\n    if (value) {\n      this.maxPrice = value;\n    }\n  }\n\n  private isChecked(filterValue: FilterValue) {\n    if (!this.minPrice && !this.maxPrice) {\n      return false;\n    }\n\n    //1 filterValue.from zero or * and this.minPrice not set or zero\n    //2 filterValue.from == this.minPrice\n    //@ts-ignore\n    let isMinEqual = ((filterValue.from < 1 || filterValue.from == '*') && this.minPrice == 0) || filterValue.from == this.minPrice;\n\n    //1 filterValue.to == \"*\" or null\n    //2 filterValue.to == this.max\n    let isMaxEqual = filterValue.to == '*' || !filterValue.to || filterValue.to == this.maxPrice;\n    return isMinEqual && isMaxEqual;\n  }\n\n\n  render() {\n    return (\n      <Host>\n        {\n          this.filterValues.map((filterValue: FilterValue, index: number) => {\n            return <label class=\"s-filters-label\" htmlFor={`${this.option.key}-${index}`}>\n              <input\n                id={`${this.option.key}-${index}`}\n                name=\"price\"\n                type=\"radio\"\n                checked={this.isChecked(filterValue)}\n                class=\"s-filters-radio\"\n                onChange={e => this.handleMinMaxPrice(e, filterValue)}\n              />\n              {this.getPriceLabel(filterValue)}\n            </label>\n          })\n        }\n\n\n        <div class=\"flex justify-center items-center\">\n          <div class=\"relative max-w-xl w-full\">\n            <div class=\"s-price-range-inputs\">\n              <div class=\"s-price-range-relative\">\n                <div class=\"s-price-range-currency\"> {salla.config.currency().symbol}</div>\n                <input\n                  type=\"number\"\n                  maxlength=\"5\"\n                  ref={el => this.minInput = el}\n                  onInput={(event) => this.changedEventHandler(event, true)}\n                  value={this.minPrice}\n                  placeholder={this.fromLabel}\n                  class=\"s-price-range-number-input\"\n                />\n              </div>\n\n              <div class=\"s-price-range-gray-text\"> -</div>\n              <div class=\"s-price-range-relative\">\n                <div class=\"s-price-range-currency\"> {salla.config.currency().symbol}</div>\n                <input type=\"number\" maxlength=\"5\"\n                  placeholder={this.toLabel}\n                  ref={el => this.maxInput = el}\n                  onInput={(event) => this.changedEventHandler(event)}\n                  value={this.maxPrice}\n                  class=\"s-price-range-number-input\" aria-describedby=\"price-currency\" />\n              </div>\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n\n  componentDidLoad() {\n    this.isReady = true;\n  }\n}\n"],"mappings":"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"}