{"version":3,"names":["sallaNotificationsCss","SallaNotifications","constructor","hostRef","salla","lang","get","onLoaded","this","no_notifications_trans","load_more_text_trans","loading","isLoading","btnText","_a","status","querySelector","Helper","toggleElementClassIf","btnLoader","style","display","getNotificationCard","notification","notificationItem","document","createElement","classList","add","render","showPlaceholder","h","class","alignment","slot","ref","wrapper","hasInfiniteScroll","onClick","loadMore","loadMoreText","handleResponse","notificationsList","map","initiateInfiniteScroll","logger","error","infiniteScroll","initiate","path","nextPage","history","scrollThreshold","button","on","_response","_b","response","pagination","links","next","data","items","host","querySelectorAll","animateItems","_c","e","anime","targets","opacity","duration","translateY","delay","_el","i","easing","complete","_anim","forEach","item","loadInitialData","api","notifications","fetch","per_page","itemPerPage","then","resp","total","setTimeout","append","catch","loadNextPage","componentWillLoad"],"sources":["src/components/salla-notifications/salla-notifications.scss?tag=salla-notifications","src/components/salla-notifications/salla-notifications.tsx"],"sourcesContent":[null,"import { Component, h, State, Prop, Element } from '@stencil/core';\nimport { Notification, Pagination } from \"./interfaces\"\nimport Helper from '../../Helpers/Helper';\nimport anime from 'animejs';\n\n@Component({\n  tag: 'salla-notifications',\n  styleUrl: 'salla-notifications.scss',\n})\nexport class SallaNotifications {\n\n  constructor() {\n    salla.lang.onLoaded(() => {\n      this.no_notifications_trans = salla.lang.get('blocks.header.no_notifications');\n      this.load_more_text_trans = salla.lang.get('common.elements.load_more')\n    })\n  }\n\n  /**\n   * Load more text\n   */\n  @Prop() loadMoreText: string;\n\n  /**\n   * Number of notifications to load per request.\n   */\n  @Prop() itemPerPage: number = 10\n\n  @State() notifications: Notification[] = []\n  @State() pagination: Pagination;\n  @State() hasInfiniteScroll: boolean;\n  @State() total: number;\n  @State() showPlaceholder: boolean;\n  @State() nextPage: string;\n\n  @State() no_notifications_trans = salla.lang.get('blocks.header.no_notifications')\n  @State() load_more_text_trans = salla.lang.get('common.elements.load_more');\n\n  private status: any;\n  private btnLoader: any;\n  private infiniteScroll: any;\n  private wrapper: any;\n\n  @Element() host: HTMLElement;\n\n  // Show/hide loading\n  private loading(isLoading = true) {\n    let btnText = this.status?.querySelector('.s-button-text');\n    if (btnText) {\n      Helper.toggleElementClassIf(btnText, 's-button-hide', 's-button-show', () => isLoading);\n      this.btnLoader.style.display = isLoading ? 'inherit' : 'none';\n    }\n  }\n\n  private getNotificationCard(notification: Notification) {\n    const notificationItem = document.createElement('salla-notification-item') as HTMLSallaNotificationItemElement;\n    notificationItem.notification = notification;\n    notificationItem.classList.add('s-block');\n    return notificationItem;\n  }\n\n\n  render() {\n\n    if (this.showPlaceholder) {\n      return <div class=\"s-notifications-no-content\">\n        <salla-placeholder alignment='center'>\n          <span slot='title'>\n            {this.no_notifications_trans}\n          </span>\n        </salla-placeholder>\n      </div>\n    }\n\n    return <div class=\"s-notifications-wrapper\">\n      <div class=\"s-notifications-container\" ref={wrapper => this.wrapper = wrapper}></div>\n\n      {this.hasInfiniteScroll && (\n        <div class=\"s-infinite-scroll-wrapper\" ref={status => this.status = status}>\n          <button onClick={() => this.loadMore()} class=\"s-infinite-scroll-btn s-button-btn s-button-primary\">\n            <span class=\"s-button-text s-infinite-scroll-btn-text\">{this.loadMoreText ?? this.load_more_text_trans}</span>\n            <span class=\"s-button-loader s-button-loader-center s-infinite-scroll-btn-loader\" ref={btnLoader => this.btnLoader = btnLoader} style={{ \"display\": \"none\" }}></span>\n          </button>\n        </div>\n      )}\n    </div>\n  }\n\n\n  private handleResponse(notificationsList: Notification[]) {\n    return notificationsList.map(notification => this.getNotificationCard(notification))\n  }\n\n  private initiateInfiniteScroll() {\n    if (!this.wrapper) {\n      salla.logger.error('Wrapper is undefined. Cannot initiate infinite scroll.');\n      return;\n    }\n\n    this.infiniteScroll = salla.infiniteScroll.initiate(this.wrapper, this.wrapper, {\n      path: () => this.nextPage,\n      history: true,\n      nextPage: this.nextPage,\n      scrollThreshold: false,\n      status: this.status,\n      button: this.status.querySelector('.s-infinite-scroll-btn'),\n    }, true);\n\n    this.infiniteScroll?.on('request', _response => {\n      this.loading();\n    });\n\n    this.infiniteScroll?.on('load', response => {\n      this.loading(false);\n      this.pagination = response.pagination;\n      this.nextPage = response.pagination.links?.next || null;\n      this.handleResponse(response.data)\n\n      let items = this.host.querySelectorAll('salla-notification-item:not(.animated)');\n      this.animateItems(items);\n    });\n\n    this.infiniteScroll?.on('error', (e) => {\n      salla.logger.error('Error loading more comments:', e);\n    });\n  }\n\n  private animateItems(items: NodeListOf<Element>) {\n    anime({\n      targets: items,\n      opacity: [0, 1],\n      duration: 1200,\n      translateY: [20, 0],\n      delay: function (_el, i) {\n        return i * 100;\n      },\n      easing: 'easeOutExpo',\n      complete: function (_anim) {\n        items.forEach((item: Element) => {\n          item.classList.add('animated');\n        })\n      }\n\n    })\n  }\n\n  private async loadInitialData() {\n    await salla.api.notifications.fetch({\"per_page\": this.itemPerPage})\n      .then(resp => {\n        this.notifications = resp.data\n        this.hasInfiniteScroll = !!resp.pagination.links.next;\n        this.pagination = resp.pagination;\n        this.total = resp.pagination.total;\n        this.nextPage = resp.pagination.links?.next || null;\n\n        setTimeout(() => {\n          this.handleResponse(resp.data).forEach(data => this.wrapper.append(data))\n          this.initiateInfiniteScroll();\n          let items = this.wrapper.querySelectorAll('salla-notification-item:not(.animated)');\n          this.animateItems(items);\n        }, 100)\n      })\n      .catch(error => {\n        salla.logger.error(error)\n        this.showPlaceholder = true;\n        this.loading(false)\n      })\n  }\n\n  // Get next page\n  async loadMore() {\n    this.infiniteScroll?.loadNextPage();\n  }\n\n  async componentWillLoad() {\n    await this.loadInitialData();\n  }\n\n}\n"],"mappings":"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"}