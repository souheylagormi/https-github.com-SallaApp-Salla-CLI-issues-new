{"version":3,"names":["sallaAdvertisementCss","SallaAdvertisement","exports","class_1","hostRef","_this","this","salla","config","get","onReady","currentSlug","advSlot","_a","host","querySelector","innerHTML","prototype","isNotVisible","advert","storage","concat","id","setCanDisplayFlag","flag","set","AnimeJS","targets","opacity","duration","height","clientHeight","easing","render","Array","isArray","advertisements","length","map","advertisement","h","class","style","colors","bg","color","text","replace","icon","url","target","description","componentWillLoad","api","fetch","then","resp","ads","data","_i","ads_1","ad","_b","sent","componentDidRender","setTimeout","closeBtn","addEventListener","querySelectorAll","forEach","el","replaceWith","firstChild","remove"],"sources":["src/components/salla-advertisement/salla-advertisement.scss?tag=salla-advertisement","src/components/salla-advertisement/salla-advertisement.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n","import { Component, State, Element, h } from '@stencil/core';\nimport { Advertisement } from './interfaces';\nimport AnimeJS from 'animejs';\n\n/**\n * @name SallaAdvertisement\n * @description A StencilJS component for handling and displaying advertisements in different pages of salla applications.\n * @tag salla-advertisement\n */\n\n/**\n * @slot adv - Replaces the entire advertisement, has replaceable props `{icon}`, `{url}`, `{target}`, `{description}`, `{bg_color}`, `{text_color}`.\n * */\n@Component({\n  tag: 'salla-advertisement',\n  styleUrl: 'salla-advertisement.scss',\n})\nexport class SallaAdvertisement {\n  /**\n  * Constructor for initializing the component.\n  */\n  constructor() {\n    salla.onReady(() => {\n      this.currentSlug = salla.config.get(\"page.slug\");\n    })\n\n    this.advSlot = this.host.querySelector('[slot=\"adv\"]')?.innerHTML || `<div class=\"s-advertisement-content\"><h2 class=\"s-advertisement-content-main\">{iconElem}{urlElem}</h2>{closeElem}</div>\n    `;\n  }\n  private readonly advSlot: string;\n  // State properties for managing component state\n  @State() position: string;\n  @State() advertisements: Advertisement[];\n  @State() advertIcon: string;\n  @State() currentSlug: string = salla.config.get(\"page.slug\");\n\n  @Element() private host: HTMLElement;\n\n\n  /**\n   * Checks whether an advertisement is marked as not visible/dismissed.\n   * @param advert - The advertisement to check.\n   * @returns True if the advertisement is not visible, false otherwise.\n   */\n  private isNotVisible(advert: Advertisement): boolean {\n    return !!salla.storage.get(`statusAd-${advert.id}`)\n  }\n\n  /**\n   * Sets a flag to control the visibility of an advertisement and triggers an animation when hiding it.\n   * @param advert - The advertisement to update.\n   * @param flag - The flag indicating whether to display or hide the advertisement.\n   */\n  private setCanDisplayFlag(advert: Advertisement, flag: boolean): void {\n    if (!flag) {\n      // Set the statusAd flag to 'dismissed'\n      salla.storage.set(`statusAd-${advert.id}`, 'dismissed');\n      // Trigger an animation to hide the advertisement\n      AnimeJS({\n        targets: this.host,\n        opacity: [1, 0],\n        duration: 300,\n        height: [this.host.clientHeight, 0],\n        easing: 'easeInOutQuad',\n      });\n    }\n  }\n\n  /**\n   * Renders the advertisements based on the fetched data and visibility status.\n   * @returns JSX for rendering advertisements.\n   */\n  render() {\n    if ((Array.isArray(this.advertisements) && !this.advertisements.length) || !this.advertisements) {\n      return;\n    }\n    return this.advertisements.map((advertisement: Advertisement) => {\n      return <div class={{ \"s-hidden\": this.isNotVisible(advertisement), 's-advertisement': true }} data-id={advertisement.id}\n        style={{ \"background-color\": advertisement.colors.bg, \"color\": advertisement.colors.text }}>\n        <div id=\"adv-slot\" innerHTML={\n          this.advSlot\n            // Replace the props with the advertisement data\n            // !Note: The props with the 'Elem' suffix are for internal use only.\n            .replace(\"{iconElem}\", `<i class=\"s-advertisement-content-icon ${advertisement.icon}\"></i>`)\n            .replace(\"{urlElem}\", advertisement.url ? `<a href=\"${advertisement.url}\" target=\"${advertisement.target}\">${advertisement.description}</a>` : advertisement.description)\n            .replace(\"{closeElem}\", `<button class=\"s-advertisement-action\" aria-label=\"close-alert\"><i class=\"sicon-cancel\"></i></button>`)\n            .replace('{icon}', advertisement.icon)\n            .replace('{url}', advertisement.url)\n            .replace('{target}', advertisement.target)\n            .replace('{description}', advertisement.description)\n            .replace('{bg_color}', advertisement.colors.bg)\n            .replace('{text_color}', advertisement.colors.text)\n        }></div>\n      </div>\n    }\n    );\n  }\n\n  /**\n  * Lifecycle method that fetches advertisements before the component is loaded.\n  */\n  async componentWillLoad() {\n    // Fetch advertisements based on the current page\n    await salla.api.advertisement.fetch(this.currentSlug)\n      .then(resp => {\n        let ads = resp.data;\n        if (Array.isArray(ads) && ads.length > 0) {\n          for (const ad of ads) {\n            if (!salla.storage.get(`statusAd-${ad.id}`)) {\n              this.advertisements = [ad];\n              break;\n            }\n          }\n        }\n      })\n  }\n  componentDidRender() {\n    if ((Array.isArray(this.advertisements) && !this.advertisements.length) || !this.advertisements) {\n      return;\n    }\n    // Add event listener for the close button\n    setTimeout(() => {\n      let closeBtn = this.host.querySelector('.s-advertisement-action');\n      if (closeBtn) {\n        closeBtn.addEventListener('click', () => this.setCanDisplayFlag(this.advertisements[0], false));\n      }\n    });\n\n    // Reduce Dom size by removing the slot element\n    this.host.querySelectorAll('#adv-slot').forEach(el => el?.replaceWith(el?.firstChild));\n    this.host.querySelector('[slot=\"adv\"]')?.remove();\n\n    // Trigger an animation to show the advertisement\n    AnimeJS({\n      targets: this.host,\n      opacity: [0, 1],\n      duration: 300,\n      height: [0, this.host.clientHeight],\n      easing: 'easeInOutQuad',\n    });\n  }\n}\n"],"mappings":"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"}