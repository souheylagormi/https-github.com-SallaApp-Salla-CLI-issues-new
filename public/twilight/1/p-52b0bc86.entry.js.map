{"version":3,"names":["sallaInstallmentCss","SallaInstallment","constructor","hostRef","this","tabbyBorderRemoved","tabbyRemoveBorderTries","salla","config","get","lang","onLoaded","installment","tamaraIsActive","includes","tabbyIsActive","spotiiIsActive","renderInstallments","event","on","data","price","render","h","Host","class","currency","language","id","isUpdating","oldTamaraScript","document","querySelector","remove","tamaraScript","createElement","setAttribute","head","appendChild","onload","window","TamaraProductWidget","init","setTimeout","oldTabbyWrapper","host","tabbyPromoWrapper","tabbyPromo","oldTabbyScript","tabbyScript","TabbyPromo","selector","querySelectorAll","forEach","element","removeTabbyBorder","oldSpotiiWrapper","spotiiPromoWrapper","classList","add","spotiiPromo","oldSpotiiScript","url","cdn","amount","money","Number","toFixed","isRTL","spotiiConfig","targetXPath","renderToPath","numberOfPayment","templateLine","textOne","textTwo","textThree","spotiiScript","promo","shadowRoot","style"],"sources":["src/components/salla-installment/salla-installment.scss?tag=salla-installment","src/components/salla-installment/salla-installment.tsx"],"sourcesContent":["/*\n  The whole installment methods is a third-party widgets,\n  So there aren't a custom classes (as other components) to style them.\n*/\n\nsalla-installment:empty {\n  display: none;\n}\n/*\n* Installment::Tabby\n*/\n#tabbyPromoWrapper {\n  background: white;\n  border-radius: 0.375rem;\n  transition: box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n  margin-bottom: 20px;\n\n  .salla-y &{\n    border: 1px solid var(--color-grey-dark);\n    border-radius: 12px\n  }\n\n  &:hover{\n    box-shadow: 0 0 #0000, 0 0 #0000, 5px 10px 30px #2B2D340D;\n  }\n\n  #tabbyPromo {\n    * {\n      font-family: var(--font-main);\n    }\n\n    > div > div {\n      max-width: none;\n      //padding: 15px;\n      box-shadow: none;\n      border: none;\n    }\n\n    .tabby-promo-snippet {\n      max-width: 100%;\n      min-height: 100px;\n      padding: 18px 20px;\n      // border-color: var(--color-grey-dark);\n      border: none !important;\n\n\n      &__text, &__link {\n        font-size: var(--font-sm);\n        color: var(--color-text) !important;\n      }\n\n      &__link {\n        font-weight: bold;\n      }\n    }\n  }\n}\n\n.tabby-promo-wrapper {\n  #tabby-promo {\n    font-family: var(--font-main) !important;\n\n    .tabby-promo {\n      &__feature-title {\n        font-size: var(--font-md);\n      }\n\n      &__feature-desc {\n        font-size: var(--font-sm);\n        line-height: 20px;\n      }\n    }\n  }\n}\n\n/*\n* Installment::Tamara & Spotii\n*/\n.tamara-product-widget{\n  margin-bottom: 20px;\n}\n\n.tamara-product-widget,\n.spotii-wrapper {\n  min-height: 100px;\n  position: relative;\n  color: var(--color-text);\n  font-size: var(--font-sm);\n  line-height: 1.25;\n  padding: 18px 20px 18px 100px !important;\n  background: white;\n  border-radius: 0.375rem;\n  transition: box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n\n  .salla-y &{\n    border-radius: 12px;\n    border: 1px solid var(--color-grey-dark);\n  }\n\n  &:hover{\n    box-shadow: 0 0 #0000, 0 0 #0000, 5px 10px 30px #2B2D340D;\n  }\n  .spotii-logo {\n    float: left;\n    margin: 0 0 0 -75px;\n  }\n}\n.ltr .tamara-product-widget,\n.ltr .spotii-wrapper{\n  text-align: left;\n  padding: 18px 100px 18px 20px !important;\n  .spotii-logo {\n    float: right;\n    margin: 0 -75px 0 0;\n  }\n  .spotii-product-widget {\n    text-align: left !important;\n  }\n}\n\n.spotii-wrapper {\n  margin-bottom: 20px;\n  .spotii-promo {\n    font-size: var(--font-md);\n  }\n\n  .spotii-product-widget {\n    font-size: var(--font-sm) !important;\n    margin-top: 10px;\n  }\n}\n\n.tamara-product-widget{\n  .tamara-logo {\n    position: absolute;\n    left: 20px;\n    top: 18px;\n    margin: 0 !important;\n\n    .ltr &{\n      right: 20px;\n      left: auto;\n    }\n  }\n\n  span {\n    font-family: var(--font-main);\n    font-size: var(--font-sm);\n    color: var(--color-text);\n\n    &:last-child {\n      display: block;\n      position: relative;\n      margin-top: 8px;\n    }\n  }\n}\n\n.tamara-popup {\n  &__wrap {\n    overflow: auto !important;\n  }\n}\n","import { Component, Host, h, Prop, State, Element } from '@stencil/core';\n\n@Component({\n  tag: 'salla-installment',\n  styleUrl: 'salla-installment.scss',\n})\n\nexport class SallaInstallment {\n  private tabbyBorderRemoved: boolean = false;\n  private tabbyRemoveBorderTries: number = 0;\n  @Element() host: HTMLElement;\n  constructor() {\n    salla.lang.onLoaded(() => {\n      const installment = salla.config.get('store.settings.installments');\n      if (installment) {\n        this.tamaraIsActive = installment.includes('tamara_installment');\n        this.tabbyIsActive = installment.includes('tabby_installment');\n        this.spotiiIsActive = installment.includes('spotii_pay');\n      }\n      this.renderInstallments();\n    });\n\n    salla.event.on('product::price.updated', ({ data }) => {\n      if (!data.price || data.price == this.price) {\n        return;\n      }\n      this.price = data.price;\n      this.renderInstallments(true);\n    });\n  }\n\n  /**\n   * Current product price\n   */\n  @Prop() price: string;\n  /**\n   * Language code\n   */\n  @Prop() language: string = salla.config.get('user.language_code');\n  /**\n   * Currency code\n   */\n  @Prop() currency: string = salla.config.get('user.currency_code');\n\n  @State() tamaraIsActive: boolean;\n  @State() tabbyIsActive: boolean;\n  @State() spotiiIsActive: boolean;\n\n  render() {\n    return (\n      <Host>\n        {this.tamaraIsActive ?\n          <div class=\"tamara-product-widget\"\n            data-price={this.price}\n            data-currency={this.currency}\n            data-lang={this.language}\n            data-payment-type=\"installment\">\n          </div>\n          : ''}\n\n        {this.tabbyIsActive ?\n          <div id=\"tabbyPromoWrapper\">\n            <div id=\"tabbyPromo\"></div>\n          </div>\n          : ''}\n\n        {this.spotiiIsActive ?\n          <div class=\"spotii-wrapper\">\n            {/*No need for the price, the price already in the page, and also tammara & tabby doesn't have price */}\n            <div class=\"spotii-promo\"></div>\n          </div>\n          : ''}\n      </Host>\n    );\n  }\n\n  renderInstallments(isUpdating: boolean = false) {\n    // Tamara\n    if (this.tamaraIsActive) {\n      if (isUpdating) {\n        var oldTamaraScript = document.querySelector('script[src=\"https://cdn.tamara.co/widget/product-widget.min.js\"]');\n        if (oldTamaraScript) {\n          oldTamaraScript.remove();\n        }\n      }\n\n      var tamaraScript = document.createElement('script');\n      tamaraScript.setAttribute('src', 'https://cdn.tamara.co/widget/product-widget.min.js');\n      document.head.appendChild(tamaraScript);\n      tamaraScript.onload = () => {\n        window.TamaraProductWidget.init({ lang: this.language });\n        setTimeout(() => {\n          window.TamaraProductWidget.render();\n        }, 300);\n      };\n    }\n\n    // tabby\n    if (this.tabbyIsActive) {\n      if (isUpdating) {\n\n        // remove #tabbyPromoWrapper and re append it\n        var oldTabbyWrapper = this.host.querySelector('#tabbyPromoWrapper');\n        if (oldTabbyWrapper) {\n          oldTabbyWrapper.remove();\n        }\n\n        var tabbyPromoWrapper = document.createElement('div');\n        tabbyPromoWrapper.setAttribute('id', 'tabbyPromoWrapper');\n        var tabbyPromo = document.createElement('div');\n        tabbyPromo.setAttribute('id', 'tabbyPromo');\n        tabbyPromoWrapper.appendChild(tabbyPromo);\n        this.host.appendChild(tabbyPromoWrapper);\n\n        var oldTabbyScript = document.querySelector('script[src=\"https://checkout.tabby.ai/tabby-promo.js\"]');\n        if (oldTabbyScript) {\n          oldTabbyScript.remove();\n        }\n      }\n\n      var tabbyScript = document.createElement('script');\n      tabbyScript.setAttribute('src', 'https://checkout.tabby.ai/tabby-promo.js');\n      document.head.appendChild(tabbyScript);\n      tabbyScript.onload = () => {\n        const TabbyPromo = window.TabbyPromo;\n        new TabbyPromo({\n          selector: '#tabbyPromo',\n          currency: this.currency,\n          price: this.price,\n          lang: this.language,\n        });\n        document.querySelectorAll('.tabby-promo-snippet__logo').forEach(function (element) {\n          element.setAttribute('aria-label', 'Tabby Logo');\n        });\n      }\n      // this is a workaround to remove the default border and add margin\n      this.removeTabbyBorder();\n    }\n\n    // Spotii\n    if (this.spotiiIsActive) {\n      if (isUpdating) {\n\n        var oldSpotiiWrapper = this.host.querySelector('.spotii-wrapper');\n        if (oldSpotiiWrapper) {\n          oldSpotiiWrapper.remove();\n        }\n\n        var spotiiPromoWrapper = document.createElement('div');\n        spotiiPromoWrapper.classList.add('spotii-wrapper');\n        var spotiiPromo = document.createElement('div');\n        spotiiPromo.classList.add('spotii-promo');\n        spotiiPromoWrapper.appendChild(spotiiPromo);\n        this.host.appendChild(spotiiPromoWrapper);\n        var oldSpotiiScript = document.querySelector('script[src=\"' + salla.url.cdn('js/price-widget-ar-salla.js') + '\"]');\n        if (oldSpotiiScript) {\n          oldSpotiiScript.remove();\n        }\n      }\n\n      let amount = salla.money((Number(this.price) / 3).toFixed(2));\n      let isRTL = salla.config.get('theme.is_rtl', true);\n      window.spotiiConfig = {\n        targetXPath: ['.spotii-wrapper'],\n        renderToPath: ['.spotii-promo'],\n        numberOfPayment: 3,\n        currency: this.currency,\n        templateLine: \"${textOne} ${number} ${textTwo} \" + amount + \"${logo} ${info}\",\n        //todo:: translate these\n        textOne: isRTL ? \"جزء الدفع على\" : \"Split it into\",\n        textTwo: isRTL ? \"أقساط متساوية بدون تكاليف اضافية بقيمة\" : \"payments of\",\n        textThree: \"مع\",\n        price: this.price,\n        // forcedShow: false,\n        // merchantID: null,\n      };\n\n      var spotiiScript = document.createElement('script');\n      spotiiScript.setAttribute('src', salla.url.cdn('js/price-widget-ar-salla.js'));\n      document.head.appendChild(spotiiScript);\n      // spotiiScript.onload = () => {\n      //   // setTimeout()\n      // }\n    }\n  }\n\n\n  /**\n   * this is workaround to remove the default border and add margin\n   * we will try to remove tabby border 5 times for 7.5 seconds\n   */\n  removeTabbyBorder() {\n    if (this.tabbyBorderRemoved || this.tabbyRemoveBorderTries > 5) {\n      return;\n    }\n    this.tabbyRemoveBorderTries++;\n    setTimeout(() => {\n      let promo: any = document.querySelector('#tabbyPromo>div>div');\n      promo = promo ? promo.shadowRoot.querySelector('div[class^=\"styles__tabby-promo-snippet--\"]') : null;\n      if (promo) {\n        promo.style = 'border: none; margin: 15px 0!important;';\n        this.tabbyBorderRemoved = true;\n      } else {\n        this.removeTabbyBorder();\n      }\n    }, this.tabbyRemoveBorderTries * 500)\n  }\n}\n"],"mappings":"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"}