{"version":3,"names":["sallaProductsListCss","SallaProductsList","exports","class_1","hostRef","_this","this","salla","lang","get","config","onLoaded","placeholderText","endOfText","failedLoadMore","prototype","connectedCallback","event","on","filters","setFilters","JSON","stringify","parsedFilters","window","scrollTo","top","behavior","parse","currentPage","slug","category_id","currentCategoryIdFilter","reload","autoload","loadMoreWrapper","style","display","hasInfiniteScroll","infiniteScroll","destroy","buildNextPageUrl","wrapper","innerHTML","init","getInitialData","showPlaceholder","placeholderLoader","document","createElement","classList","add","host","insertAdjacentElement","isFilterable","filtersResults","isSourceWithoutValue","includes","getSource","animateItems","anime","targets","opacity","duration","translateY","delay","_el","i","initBaseNextPageUrl","source","nextPage","url","api","concat","limit","sortBy","key","value","this_1","encodeURIComponent","Array","isArray","forEach","item","_j","_k","Object","entries","length","_l","k","v","_i","_g","_h","getSourceValue","join","e","logger","warn","sourceValueIsValid","loading","isLoading","isBtn","btnLoader","loader","currentLoader","getItemHTML","product","customComponentTag","hasCustomComponent","productCardComponent","productCard","applyLandingPageStyles","applyHorizontalCardStyles","toggleAttribute","horizontalCards","setAttribute","Helper","getProductsSource","getProductsSourceValue","sourceValue","appendDataLayer","data","scriptElement","dataLayer","ecommerce","currencyCode","impressions","map","id","name","price","brand","quantity","variant","categories","category","page","pageName","mobileApp","referrer","theme","appendChild","createTextNode","head","initiateInfiniteScroll","initiate","path","history","scrollThreshold","loadOnScroll","_a","_b","response","pageIndex","remove","appendItems","handleResponse","_c","status","querySelector","onReady","loadNextPage","loadMore","componentWillLoad","onSallaReadyPromise","customElements","searchParams","URLSearchParams","location","search","extractFiltersFromUrl","message","isReady","setTimeout","append","fetchProducts","then","res","card","canRender","render","h","class","ShoppingBag","Host","ref","onClick","loadMoreText","componentDidLoad","title","cursor","current","getPageTitleForSource","word","catId_1","_d","find","filter","values","cat","choice","_e","replace","emit","productsFetched","next","option","_f"],"sources":["src/components/salla-products-list/salla-products-list.scss?tag=salla-products-list","src/components/salla-products-list/salla-products-list.tsx"],"sourcesContent":["\n","import { Component, Host, h, Prop, State, Element, Method, Event, EventEmitter } from '@stencil/core';\nimport anime from 'animejs';\nimport ShoppingBag from '../../assets/svg/shopping-bag.svg';\nimport Helper from '../../Helpers/Helper';\n@Component({\n  tag: 'salla-products-list',\n  styleUrl: 'salla-products-list.scss'\n})\nexport class SallaProductsList {\n  constructor() {\n    salla.lang.onLoaded(() => {\n      this.placeholderText = salla.lang.get('pages.categories.no_products');\n      this.endOfText = salla.lang.get('common.elements.end_of_content');\n      this.failedLoadMore = salla.lang.get('common.elements.failed_to_load_more');\n    })\n  }\n  connectedCallback() {\n    salla.event.on('salla-filters::changed', filters => this.setFilters(filters))\n  }\n\n  /**\n   * Set parsed filters data from URI\n   * @param filters\n   */\n  @Method()\n  async setFilters(filters) {\n    if (!filters || JSON.stringify(filters) === JSON.stringify(this.parsedFilters)) {\n      return;\n    }\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n    // Create a deep copy of the filters object to avoid mutating the original object\n    this.parsedFilters = JSON.parse(JSON.stringify(filters));\n    if (this.currentPage.slug == \"product.index\" && this.parsedFilters && this.parsedFilters.category_id) {\n      this.currentCategoryIdFilter = [this.parsedFilters.category_id]\n    }\n    return this.reload();\n  }\n\n  /**\n   * Reload the list of products (entire content of the component).\n   */\n  @Method()\n  async reload() {\n    !this.autoload && this.loadMoreWrapper && (this.loadMoreWrapper.style.display = 'none');\n    this.hasInfiniteScroll && salla.infiniteScroll.destroy(this.infiniteScroll);\n    this.buildNextPageUrl();\n    // TODO: this is problematic in testing, for the time being it's been resolved like this\n    this.wrapper.innerHTML = '';\n    if (this.hasInfiniteScroll) {\n      this.init();\n    } else {\n      this.getInitialData();\n    }\n    // Special case for the placeholder loader\n    if (this.showPlaceholder) {\n      this.showPlaceholder = false;\n      this.placeholderLoader = document.createElement('div');\n      this.placeholderLoader.classList.add('s-products-list-loading-wrapper');\n      this.placeholderLoader.style.display = 'inherit';\n      this.placeholderLoader.innerHTML = `<span class=\"s-button-loader s-button-loader-center s-infinite-scroll-btn-loader\"></span>`;\n      this.host.insertAdjacentElement('afterend', this.placeholderLoader);\n    }\n  }\n\n\n  private status: HTMLDivElement;\n  private btnLoader: HTMLElement;\n  private loader: HTMLElement;\n  private placeholderLoader: HTMLElement;\n  private loadMoreWrapper: HTMLElement;\n  @Element() host: HTMLElement;\n  private wrapper: any;\n  private infiniteScroll: any;\n  /**\n   * The source of the products list\n   * @type {string}\n   * */\n  @Prop({\n    reflect: true,\n    mutable: true\n  }) source: 'categories' | 'latest' | 'related' | 'brands' | 'json' | 'search' | 'tags' | 'selected' | 'offers' | 'landing-page' | 'sales' | 'wishlist';\n\n  /**\n   * The source value, cloud be different values as following:\n   * - array of ids when `source` in ['categories', 'brands', 'tags', 'selected']\n   * - keyword when `source` = 'search'\n   * - products payload when `source` = 'json'\n   * - product_id when `source` = 'related'\n   *\n   * @type {string}\n   * */\n  @Prop({ mutable: true }) sourceValue: any;\n\n  /**\n   * Limit for number of products in the list.\n   */\n  @Prop({ mutable: true }) limit: number;\n\n  /**\n   * Sorting the list of products\n   */\n  @Prop({ mutable: true }) sortBy?: string | 'ourSuggest' | 'bestSell' | 'topRated' | 'priceFromTopToLow' | 'priceFromLowToTop';\n\n  /**\n   * should listen to filters events `salla-filters::changed` and re-render\n   */\n  @Prop({ reflect: true, mutable: true }) filtersResults: boolean;\n\n  /**\n   * Horizontal cards\n   */\n  @Prop({ reflect: true }) horizontalCards: boolean\n\n  /**\n   * Autoload next page when scroll\n   */\n  @Prop({ mutable: true }) autoload: boolean = false;\n\n  /**\n * Load more text\n */\n  @Prop() loadMoreText: string;\n\n  /**\n   * Custom Card Component for the Salla Products List.\n   *\n   * This component allows you to customize the appearance of individual product cards within a Salla Products List.\n   *\n   * @example\n   * <salla-products-list product-card-component=\"my-custom-card-style1\" ...\n   * <salla-products-list product-card-component=\"my-custom-card-style2\" ...\n   */\n  @Prop() productCardComponent: string = 'custom-salla-product-card';\n\n  // State\n  @State() page: number = 1;\n  @State() nextPage: string;\n  @State() hasInfiniteScroll: boolean;\n  @State() hasCustomComponent: boolean;\n  @State() sourceValueIsValid: boolean;\n  @State() placeholderText: string = salla.lang.get('pages.categories.no_products');\n  @State() endOfText: string = salla.lang.get('common.elements.end_of_content');\n  @State() failedLoadMore: string = salla.lang.get('common.elements.failed_to_load_more');\n  @State() currentPage: any = salla.config.get('page');\n  @State() currentCategoryIdFilter: any;\n  @State() isReady: boolean;\n  @State() showPlaceholder: boolean;\n  @State() parsedFilters: any;\n\n  /**\n   * Custom event fired when the the products fetched.\n   */\n  @Event() productsFetched: EventEmitter;\n\n  private isFilterable() {\n    return salla.config.get('store.settings.product.filters') && this.filtersResults;\n  }\n\n  private isSourceWithoutValue() {\n    return ['offers', 'latest', 'sales'].includes(this.getSource());\n  }\n\n  private animateItems() {\n    anime({\n      targets: 'salla-products-list salla-product-card',\n      opacity: [0, 1],\n      duration: 1200,\n      translateY: [20, 0],\n      delay: function (_el, i) {\n        return i * 100;\n      },\n    })\n  }\n\n\n  private initBaseNextPageUrl(source: string) {\n\n    this.nextPage = salla.url.api(`products?source=${source}`);\n\n    if (this.limit) {\n      this.nextPage += `&per_page=${this.limit > 32 ? 32 : this.limit}`;\n    }\n    if (this.sortBy) {\n      this.nextPage += `&sort=${this.sortBy}`;\n    }\n    // if (!this.isFilterable()) {\n    //   return this.nextPage;\n    // }\n    this.nextPage += '&filterable=1';\n    for (const [key, value] of Object.entries(this.parsedFilters || {})) {\n      if ([\"string\", \"number\"].includes(typeof value)) {\n        // @ts-ignore\n        this.nextPage += `&filters[${encodeURIComponent(key)}]=${encodeURIComponent(value)}`;\n      } else if (Array.isArray(value)) {\n        value.forEach(item => this.nextPage += `&filters[${encodeURIComponent(key)}][]=${encodeURIComponent(item)}`);\n      } else if (typeof value === 'object') {\n        for (const [k, v] of Object.entries(value)) {\n          this.nextPage += `&filters[${encodeURIComponent(key)}][${encodeURIComponent(k)}]=${encodeURIComponent(v)}`;\n        }\n      }\n    }\n  }\n\n  private buildNextPageUrl() {\n    let source = this.getSource();\n    if (source === 'json') {\n      return;\n    }\n    this.initBaseNextPageUrl(source);\n    if (this.isSourceWithoutValue()) {\n      return;\n    }\n\n    if (['search', 'related', 'landing-page'].includes(source)) {\n      this.nextPage += `&source_value=${this.getSourceValue()}`;\n      return;\n    }\n    try {\n      this.nextPage += `&source_value[]=${this.getSourceValue().join('&source_value[]=')}`;\n    } catch (e) {\n      salla.logger.warn(`source-value prop should be array of ids ex source-value=\"[1,2,3]\" for the source [${source}]`);\n      this.sourceValueIsValid = false;\n    }\n  }\n\n\n  private loading(isLoading = true, isBtn = false) {\n    if (!isLoading) {\n      if (!this.autoload) {\n        this.btnLoader && (this.btnLoader.style.display = 'none');\n      }\n      this.loader && (this.loader.style.display = 'none');\n    } else {\n      let currentLoader = isBtn && !this.autoload ? this.btnLoader : this.loader;\n      currentLoader && (currentLoader.style.display = 'inherit');\n    }\n  }\n\n  private getItemHTML(product) {\n    //as a request they don't want to let the user to open the product details\n    //todo:: find a better way to handle this request\n    this.getSource() === 'landing-page' && (product.url = '');\n    const customComponentTag = this.hasCustomComponent ? this.productCardComponent : 'salla-product-card';\n    const productCard = document.createElement(customComponentTag) as HTMLSallaProductCardElement;\n\n    productCard.product = product;\n\n    this.applyLandingPageStyles(productCard);\n    this.applyHorizontalCardStyles(productCard);\n\n    return productCard;\n  }\n\n  private applyLandingPageStyles(productCard) {\n    if (this.getSource() === 'landing-page' && !this.hasCustomComponent) {\n      productCard.toggleAttribute('hide-add-btn', true);\n      productCard.classList.add('s-product-card-fit-height');\n    }\n  }\n\n  private applyHorizontalCardStyles(productCard) {\n    if (!this.horizontalCards) {\n      return;\n    }\n    productCard.setAttribute('horizontal', true);\n    if (!this.hasCustomComponent) {\n      productCard.setAttribute('shadow-on-hover', true);\n    }\n\n  }\n\n  private getSource() {\n    return Helper.getProductsSource(this.source);\n  }\n\n  private getSourceValue() {\n    return this.currentCategoryIdFilter ? this.currentCategoryIdFilter : Helper.getProductsSourceValue(this.source, this.sourceValue);\n  }\n  //@ts-ignore\n  private appendDataLayer(data) {\n    const scriptElement = document.createElement('script');\n    let dataLayer = {\n      \"event\": \"impressions\",\n      \"ecommerce\": {\n        \"currencyCode\": salla.config.get('user.currency_code'),\n        // \"event_id\":\"\", // todo\n        \"impressions\": data.map((product) => {\n          return {\n            \"id\": product.id,\n            \"name\": product.name,\n            \"price\": product.price,\n            \"brand\": \"\",\n            \"quantity\": product.quantity,\n            \"variant\": \"\",\n            \"categories\": [\n              {\n                \"name\": salla.config.get('page.title'),\n                \"id\": salla.config.get('page.id')\n              }\n            ],\n            \"category\": salla.config.get('page.title')\n          }\n        }),\n        \"page\": {\n          // \"fingerprint\":\"\", // todo\n          \"pageName\": salla.config.get('page.slug'),\n          \"mobileApp\": 0,\n          \"referrer\": document.referrer,\n          \"theme\": salla.config.get('theme.name')\n        },\n      }\n    }\n    scriptElement.appendChild(document.createTextNode('window.dataLayer = window.dataLayer || [];'));\n    scriptElement.appendChild(document.createTextNode('window.dataLayer.push(' + JSON.stringify(dataLayer) + ');'));\n    document.head.appendChild(scriptElement);\n  }\n\n  private initiateInfiniteScroll() {\n    if (!this.hasInfiniteScroll) {\n      return;\n    }\n    this.infiniteScroll = salla.infiniteScroll.initiate(this.wrapper, this.wrapper, {\n      path: () => this.nextPage,\n      history: false,\n      nextPage: this.nextPage,\n      scrollThreshold: this.autoload ? 100 : false,\n      loadOnScroll: this.autoload,\n    }, /* infinite via api*/true);\n    this.infiniteScroll?.on('request', () => {\n      this.loading(true, this.autoload ? false : true);\n    })\n    this.infiniteScroll?.on('load', response => {\n      if (!response.data?.length && this.infiniteScroll.pageIndex == 2) {\n        this.showPlaceholder = true;\n        salla.infiniteScroll.destroy(this.infiniteScroll);\n        this.loading(false);\n        this.placeholderLoader && this.placeholderLoader.remove();\n        return;\n      } else {\n        this.showPlaceholder = false;\n\n      }\n      this.infiniteScroll.appendItems(this.handleResponse(response))\n      if (this.infiniteScroll.pageIndex == 2) {\n        //todo::test it more\n        /*if (['categories', 'brands', 'tags', 'search', 'latest'].includes(this.getSource())) {\n          this.appendDataLayer(response.data);\n        }*/\n        if (!this.autoload && this.nextPage) {\n          this.loadMoreWrapper.style.display = 'block';\n        }\n        this.animateItems();\n      }\n    })\n    this.infiniteScroll?.on('error', () => {\n      this.status.querySelector('.s-infinite-scroll-error').classList.remove('s-hidden')\n      this.placeholderLoader && this.placeholderLoader.remove();\n      this.loading(false);\n    });\n    salla.onReady(() => salla.infiniteScroll.loadNextPage(this.infiniteScroll))\n  }\n  async loadMore() {\n    this.infiniteScroll?.loadNextPage();\n  }\n\n  componentWillLoad() {\n    return Helper.onSallaReadyPromise(() => {\n      this.hasCustomComponent = !!customElements.get(this.productCardComponent);\n      this.sourceValueIsValid = !!(this.getSourceValue() || this.isSourceWithoutValue());\n      this.hasInfiniteScroll = !['json', 'selected', 'related', 'landing-page'].includes(this.getSource()) && !this.limit;\n      let searchParams = new URLSearchParams(window.location.search);\n\n\n      try {\n        this.sortBy = this.sortBy || searchParams.get('sort') || searchParams.get('by');\n\n        this.parsedFilters = Helper.extractFiltersFromUrl(searchParams);\n\n        if (this.parsedFilters && this.parsedFilters.category_id) {\n          this.currentCategoryIdFilter = [this.parsedFilters.category_id];\n        }\n      } catch (e) {\n        salla.logger.warn('failed to get filters from url', e.message);\n      }\n\n\n      this.buildNextPageUrl();\n\n      this.isReady = true;\n\n      if (!this.sourceValueIsValid) {\n        salla.logger.warn(`source-value prop is required for source [${this.getSource()}]`);\n        return;\n      }\n      if (this.hasInfiniteScroll) {\n        return;\n      }\n\n      // Handle json source\n      if (this.getSource() === 'json') {\n        if (!this.getSourceValue().length) {\n          this.showPlaceholder = true;\n          return;\n        }\n        setTimeout(() => {\n          this.getSourceValue().map(product => this.wrapper.append(this.getItemHTML(product)));\n        });\n        return;\n      }\n\n      // Handle selected source\n      if (this.getSource() === 'selected' && !this.getSourceValue().length) {\n        this.showPlaceholder = true;\n        return;\n      }\n\n      return this.getInitialData();\n    });\n  }\n\n  private getInitialData() {\n    this.loading();\n    Helper.fetchProducts(this.getSource(), this.getSourceValue(), this.limit).then(res => {\n      if (!res.data.length) {\n        this.showPlaceholder = true;\n        this.placeholderLoader && this.placeholderLoader.remove();\n        this.loading(false);\n        return;\n      }\n      setTimeout(() => {\n        this.handleResponse(res).forEach(card => this.wrapper.append(card));\n      }, 100);\n    });\n  }\n\n  private canRender() {\n    return this.sourceValueIsValid && this.isReady;\n  }\n\n  render() {\n    if (!this.canRender()) {\n      return '';\n    }\n\n    if (this.showPlaceholder) {\n      return <div class=\"s-products-list-placeholder\">\n        <span innerHTML={ShoppingBag} />\n        <p>{this.placeholderText}</p>\n      </div>\n    }\n    return (\n      <Host class=\"s-products-list\">\n        <div class={{\n          \"s-products-list-wrapper\": true,\n          's-products-list-horizontal-cards': this.horizontalCards && !this.filtersResults,\n          's-products-list-vertical-cards': !this.horizontalCards && !this.filtersResults,\n          's-products-list-filters-results': this.filtersResults,\n        }}\n          ref={wrapper => this.wrapper = wrapper} />\n        <div class=\"s-infinite-scroll-status\" ref={status => this.status = status}>\n          <p class=\"s-infinite-scroll-last infinite-scroll-last s-hidden\" >{this.endOfText}</p>\n          <p class=\"s-infinite-scroll-error infinite-scroll-error s-hidden\">{this.failedLoadMore}</p>\n        </div>\n\n        <div class=\"s-products-list-loading-wrapper\" style={{ \"display\": \"none\" }} ref={loader => this.loader = loader}><span class=\"s-button-loader s-button-loader-center s-infinite-scroll-btn-loader\"></span></div>\n\n        {this.hasInfiniteScroll && this.nextPage && !this.autoload ? (\n          <div class=\"s-infinite-scroll-wrapper\" style={{ \"display\": \"none\" }} ref={loadMoreWrapper => this.loadMoreWrapper = loadMoreWrapper}>\n            <button onClick={() => this.loadMore()} class=\"s-infinite-scroll-btn s-button-btn s-button-primary\">\n              <span class=\"s-button-text s-infinite-scroll-btn-text\">{this.loadMoreText ? this.loadMoreText : salla.lang.get('common.elements.load_more')}</span>\n              <span class=\"s-button-loader s-button-loader-center s-infinite-scroll-btn-loader\" ref={btnLoader => this.btnLoader = btnLoader} style={{ \"display\": \"none\" }}></span>\n            </button>\n          </div>\n        ) : \"\"}\n      </Host>\n    );\n  }\n\n  componentDidLoad() {\n    this.hasInfiniteScroll && this.init();\n  }\n\n  private init() {\n    this.initiateInfiniteScroll();\n    this.loading();\n  }\n\n  private handleResponse(response): Array<HTMLElement> {\n    let source = this.getSource();\n    let title = '';\n    //help the developer to know the current page title\n    if (response.cursor?.current === 1) {\n      title = Helper.getPageTitleForSource(source);\n      try {\n        if (this.getSource() === 'search') {\n          title = salla.lang.get('common.elements.search_about', { 'word': this.getSourceValue() });\n        } else if (!title) {\n          let catId = this.parsedFilters.category_id || this.getSourceValue()[0];\n          // get the first filter that its key is category_id, then get the value when filter.value.*.key==catId\n          title = response.filters.find(filter => filter.key == 'category_id')?.values?.find(cat => cat.key == catId)?.value || '';\n        }\n        title += (title ? ' - ' : '') + salla.lang.choice('blocks.header.products_count', response.data?.length);\n        if (response.data.length === 15) {\n          title = title.replace(response.data.length, salla.lang.get('common.elements.more_than') + ' ' + response.data.length)\n        }\n        response.title = title;\n      } catch (e) { }\n    }\n\n    salla.event.emit('salla-products-list::products.fetched', response);\n    this.productsFetched.emit(response);\n    //💡 when source is related, cursor will not be existed\n    if (response.filters && this.isFilterable()) {\n      this.filtersResults = true;\n      salla.event.emit('filters::fetched', { filters: response.filters });\n    } else if (this.isFilterable()) {\n      salla.event.emit('filters::hidden');\n    }\n    this.nextPage = response.cursor ? response.cursor.next : this.nextPage;\n    this.loading(false);\n    this.placeholderLoader && this.placeholderLoader.remove();\n    if (this.hasInfiniteScroll && !this.nextPage) {\n      this.infiniteScroll.option({ scrollThreshold: false, loadOnScroll: false });\n      this.status.querySelector('.s-infinite-scroll-last').classList.remove('s-hidden');\n    }\n    return response.data?.map(product => this.getItemHTML(product)) || [];\n  }\n}\n"],"mappings":";;;q9BAAA,IAAMA,EAAuB,G,ICQhBC,EAAiBC,EAAA,iCAC5B,SAAAC,EAAAC,GAAA,IAAAC,EAAAC,K,kOA2G6C,M,sDAgBN,4B,UAGf,E,kJAKWC,MAAMC,KAAKC,IAAI,gC,eACrBF,MAAMC,KAAKC,IAAI,kC,oBACVF,MAAMC,KAAKC,IAAI,uC,iBACrBF,MAAMG,OAAOD,IAAI,Q,0HArI3CF,MAAMC,KAAKG,UAAS,WAClBN,EAAKO,gBAAkBL,MAAMC,KAAKC,IAAI,gCACtCJ,EAAKQ,UAAYN,MAAMC,KAAKC,IAAI,kCAChCJ,EAAKS,eAAiBP,MAAMC,KAAKC,IAAI,sC,IAGzCN,EAAAY,UAAAC,kBAAA,eAAAX,EAAAC,KACEC,MAAMU,MAAMC,GAAG,0BAA0B,SAAAC,GAAW,OAAAd,EAAKe,WAAWD,EAAhB,G,EAQhDhB,EAAAY,UAAAK,WAAN,SAAiBD,G,qFACf,IAAKA,GAAWE,KAAKC,UAAUH,KAAaE,KAAKC,UAAUhB,KAAKiB,eAAgB,CAC9E,S,CAEFC,OAAOC,SAAS,CAAEC,IAAK,EAAGC,SAAU,WAEpCrB,KAAKiB,cAAgBF,KAAKO,MAAMP,KAAKC,UAAUH,IAC/C,GAAIb,KAAKuB,YAAYC,MAAQ,iBAAmBxB,KAAKiB,eAAiBjB,KAAKiB,cAAcQ,YAAa,CACpGzB,KAAK0B,wBAA0B,CAAC1B,KAAKiB,cAAcQ,Y,CAErD,SAAOzB,KAAK2B,S,QAOR9B,EAAAY,UAAAkB,OAAN,W,sFACG3B,KAAK4B,UAAY5B,KAAK6B,kBAAoB7B,KAAK6B,gBAAgBC,MAAMC,QAAU,QAChF/B,KAAKgC,mBAAqB/B,MAAMgC,eAAeC,QAAQlC,KAAKiC,gBAC5DjC,KAAKmC,mBAELnC,KAAKoC,QAAQC,UAAY,GACzB,GAAIrC,KAAKgC,kBAAmB,CAC1BhC,KAAKsC,M,KACA,CACLtC,KAAKuC,gB,CAGP,GAAIvC,KAAKwC,gBAAiB,CACxBxC,KAAKwC,gBAAkB,MACvBxC,KAAKyC,kBAAoBC,SAASC,cAAc,OAChD3C,KAAKyC,kBAAkBG,UAAUC,IAAI,mCACrC7C,KAAKyC,kBAAkBX,MAAMC,QAAU,UACvC/B,KAAKyC,kBAAkBJ,UAAY,4FACnCrC,KAAK8C,KAAKC,sBAAsB,WAAY/C,KAAKyC,kB,kBA8F7C5C,EAAAY,UAAAuC,aAAA,WACN,OAAO/C,MAAMG,OAAOD,IAAI,mCAAqCH,KAAKiD,c,EAG5DpD,EAAAY,UAAAyC,qBAAA,WACN,MAAO,CAAC,SAAU,SAAU,SAASC,SAASnD,KAAKoD,Y,EAG7CvD,EAAAY,UAAA4C,aAAA,WACNC,EAAM,CACJC,QAAS,yCACTC,QAAS,CAAC,EAAG,GACbC,SAAU,KACVC,WAAY,CAAC,GAAI,GACjBC,MAAO,SAAUC,EAAKC,GACpB,OAAOA,EAAI,G,KAMThE,EAAAY,UAAAqD,oBAAA,SAAoBC,GAApB,IAAAhE,EAAAC,KAENA,KAAKgE,SAAW/D,MAAMgE,IAAIC,IAAI,mBAAAC,OAAmBJ,IAEjD,GAAI/D,KAAKoE,MAAO,CACdpE,KAAKgE,UAAY,aAAAG,OAAanE,KAAKoE,MAAQ,GAAK,GAAKpE,KAAKoE,M,CAE5D,GAAIpE,KAAKqE,OAAQ,CACfrE,KAAKgE,UAAY,SAAAG,OAASnE,KAAKqE,O,CAKjCrE,KAAKgE,UAAY,gB,eACLM,EAAKC,GACf,GAAI,CAAC,SAAU,UAAUpB,gBAAgBoB,GAAQ,CAE/CC,EAAKR,UAAY,YAAAG,OAAYM,mBAAmBH,GAAI,MAAAH,OAAKM,mBAAmBF,G,MACvE,GAAIG,MAAMC,QAAQJ,GAAQ,CAC/BA,EAAMK,SAAQ,SAAAC,GAAQ,OAAA9E,EAAKiE,UAAY,YAAAG,OAAYM,mBAAmBH,GAAI,QAAAH,OAAOM,mBAAmBI,GAA9E,G,MACjB,UAAWN,IAAU,SAAU,CACpC,IAAqB,IAAAO,EAAA,EAAAC,EAAAC,OAAOC,QAAQV,GAAfO,EAAAC,EAAAG,OAAAJ,IAAuB,CAAjC,IAAAK,EAAAJ,EAAAD,GAACM,EAACD,EAAA,GAAEE,EAACF,EAAA,GACdX,EAAKR,UAAY,YAAAG,OAAYM,mBAAmBH,GAAI,MAAAH,OAAKM,mBAAmBW,GAAE,MAAAjB,OAAKM,mBAAmBY,G,eAR5G,IAA2B,IAAAC,EAAA,EAAAC,EAAAP,OAAOC,QAAQjF,KAAKiB,eAAiB,IAArCqE,EAAAC,EAAAL,OAAAI,IAAwC,CAAxD,IAAAE,EAAAD,EAAAD,GAAChB,EAAGkB,EAAA,GAAEjB,EAAKiB,EAAA,G,EAAVlB,EAAKC,E,GAcX1E,EAAAY,UAAA0B,iBAAA,WACN,IAAI4B,EAAS/D,KAAKoD,YAClB,GAAIW,IAAW,OAAQ,CACrB,M,CAEF/D,KAAK8D,oBAAoBC,GACzB,GAAI/D,KAAKkD,uBAAwB,CAC/B,M,CAGF,GAAI,CAAC,SAAU,UAAW,gBAAgBC,SAASY,GAAS,CAC1D/D,KAAKgE,UAAY,iBAAAG,OAAiBnE,KAAKyF,kBACvC,M,CAEF,IACEzF,KAAKgE,UAAY,mBAAAG,OAAmBnE,KAAKyF,iBAAiBC,KAAK,oB,CAC/D,MAAOC,GACP1F,MAAM2F,OAAOC,KAAK,sFAAA1B,OAAsFJ,EAAM,MAC9G/D,KAAK8F,mBAAqB,K,GAKtBjG,EAAAY,UAAAsF,QAAA,SAAQC,EAAkBC,GAAlB,GAAAD,SAAA,GAAAA,EAAA,IAAgB,CAAE,GAAAC,SAAA,GAAAA,EAAA,KAAa,CAC7C,IAAKD,EAAW,CACd,IAAKhG,KAAK4B,SAAU,CAClB5B,KAAKkG,YAAclG,KAAKkG,UAAUpE,MAAMC,QAAU,O,CAEpD/B,KAAKmG,SAAWnG,KAAKmG,OAAOrE,MAAMC,QAAU,O,KACvC,CACL,IAAIqE,EAAgBH,IAAUjG,KAAK4B,SAAW5B,KAAKkG,UAAYlG,KAAKmG,OACpEC,IAAkBA,EAActE,MAAMC,QAAU,U,GAI5ClC,EAAAY,UAAA4F,YAAA,SAAYC,GAGlBtG,KAAKoD,cAAgB,iBAAmBkD,EAAQrC,IAAM,IACtD,IAAMsC,EAAqBvG,KAAKwG,mBAAqBxG,KAAKyG,qBAAuB,qBACjF,IAAMC,EAAchE,SAASC,cAAc4D,GAE3CG,EAAYJ,QAAUA,EAEtBtG,KAAK2G,uBAAuBD,GAC5B1G,KAAK4G,0BAA0BF,GAE/B,OAAOA,C,EAGD7G,EAAAY,UAAAkG,uBAAA,SAAuBD,GAC7B,GAAI1G,KAAKoD,cAAgB,iBAAmBpD,KAAKwG,mBAAoB,CACnEE,EAAYG,gBAAgB,eAAgB,MAC5CH,EAAY9D,UAAUC,IAAI,4B,GAItBhD,EAAAY,UAAAmG,0BAAA,SAA0BF,GAChC,IAAK1G,KAAK8G,gBAAiB,CACzB,M,CAEFJ,EAAYK,aAAa,aAAc,MACvC,IAAK/G,KAAKwG,mBAAoB,CAC5BE,EAAYK,aAAa,kBAAmB,K,GAKxClH,EAAAY,UAAA2C,UAAA,WACN,OAAO4D,EAAOC,kBAAkBjH,KAAK+D,O,EAG/BlE,EAAAY,UAAAgF,eAAA,WACN,OAAOzF,KAAK0B,wBAA0B1B,KAAK0B,wBAA0BsF,EAAOE,uBAAuBlH,KAAK+D,OAAQ/D,KAAKmH,Y,EAG/GtH,EAAAY,UAAA2G,gBAAA,SAAgBC,GACtB,IAAMC,EAAgB5E,SAASC,cAAc,UAC7C,IAAI4E,EAAY,CACd5G,MAAS,cACT6G,UAAa,CACXC,aAAgBxH,MAAMG,OAAOD,IAAI,sBAEjCuH,YAAeL,EAAKM,KAAI,SAACrB,GACvB,MAAO,CACLsB,GAAMtB,EAAQsB,GACdC,KAAQvB,EAAQuB,KAChBC,MAASxB,EAAQwB,MACjBC,MAAS,GACTC,SAAY1B,EAAQ0B,SACpBC,QAAW,GACXC,WAAc,CACZ,CACEL,KAAQ5H,MAAMG,OAAOD,IAAI,cACzByH,GAAM3H,MAAMG,OAAOD,IAAI,aAG3BgI,SAAYlI,MAAMG,OAAOD,IAAI,c,IAGjCiI,KAAQ,CAENC,SAAYpI,MAAMG,OAAOD,IAAI,aAC7BmI,UAAa,EACbC,SAAY7F,SAAS6F,SACrBC,MAASvI,MAAMG,OAAOD,IAAI,iBAIhCmH,EAAcmB,YAAY/F,SAASgG,eAAe,+CAClDpB,EAAcmB,YAAY/F,SAASgG,eAAe,yBAA2B3H,KAAKC,UAAUuG,GAAa,OACzG7E,SAASiG,KAAKF,YAAYnB,E,EAGpBzH,EAAAY,UAAAmI,uBAAA,eAAA7I,EAAAC,K,UACN,IAAKA,KAAKgC,kBAAmB,CAC3B,M,CAEFhC,KAAKiC,eAAiBhC,MAAMgC,eAAe4G,SAAS7I,KAAKoC,QAASpC,KAAKoC,QAAS,CAC9E0G,KAAM,WAAM,OAAA/I,EAAKiE,QAAL,EACZ+E,QAAS,MACT/E,SAAUhE,KAAKgE,SACfgF,gBAAiBhJ,KAAK4B,SAAW,IAAM,MACvCqH,aAAcjJ,KAAK4B,UACG,OACxBsH,EAAAlJ,KAAKiC,kBAAc,MAAAiH,SAAA,SAAAA,EAAEtI,GAAG,WAAW,WACjCb,EAAKgG,QAAQ,KAAMhG,EAAK6B,SAAW,MAAQ,K,KAE7CuH,EAAAnJ,KAAKiC,kBAAc,MAAAkH,SAAA,SAAAA,EAAEvI,GAAG,QAAQ,SAAAwI,G,MAC9B,MAAKF,EAAAE,EAAS/B,QAAI,MAAA6B,SAAA,SAAAA,EAAEhE,SAAUnF,EAAKkC,eAAeoH,WAAa,EAAG,CAChEtJ,EAAKyC,gBAAkB,KACvBvC,MAAMgC,eAAeC,QAAQnC,EAAKkC,gBAClClC,EAAKgG,QAAQ,OACbhG,EAAK0C,mBAAqB1C,EAAK0C,kBAAkB6G,SACjD,M,KACK,CACLvJ,EAAKyC,gBAAkB,K,CAGzBzC,EAAKkC,eAAesH,YAAYxJ,EAAKyJ,eAAeJ,IACpD,GAAIrJ,EAAKkC,eAAeoH,WAAa,EAAG,CAKtC,IAAKtJ,EAAK6B,UAAY7B,EAAKiE,SAAU,CACnCjE,EAAK8B,gBAAgBC,MAAMC,QAAU,O,CAEvChC,EAAKsD,c,MAGToG,EAAAzJ,KAAKiC,kBAAc,MAAAwH,SAAA,SAAAA,EAAE7I,GAAG,SAAS,WAC/Bb,EAAK2J,OAAOC,cAAc,4BAA4B/G,UAAU0G,OAAO,YACvEvJ,EAAK0C,mBAAqB1C,EAAK0C,kBAAkB6G,SACjDvJ,EAAKgG,QAAQ,M,IAEf9F,MAAM2J,SAAQ,WAAM,OAAA3J,MAAMgC,eAAe4H,aAAa9J,EAAKkC,eAAvC,G,EAEhBpC,EAAAY,UAAAqJ,SAAN,W,4FACEZ,EAAAlJ,KAAKiC,kBAAc,MAAAiH,SAAA,SAAAA,EAAEW,e,iBAGvBhK,EAAAY,UAAAsJ,kBAAA,eAAAhK,EAAAC,KACE,OAAOgH,EAAOgD,qBAAoB,WAChCjK,EAAKyG,qBAAuByD,eAAe9J,IAAIJ,EAAK0G,sBACpD1G,EAAK+F,sBAAwB/F,EAAK0F,kBAAoB1F,EAAKmD,wBAC3DnD,EAAKiC,mBAAqB,CAAC,OAAQ,WAAY,UAAW,gBAAgBmB,SAASpD,EAAKqD,eAAiBrD,EAAKqE,MAC9G,IAAI8F,EAAe,IAAIC,gBAAgBjJ,OAAOkJ,SAASC,QAGvD,IACEtK,EAAKsE,OAAStE,EAAKsE,QAAU6F,EAAa/J,IAAI,SAAW+J,EAAa/J,IAAI,MAE1EJ,EAAKkB,cAAgB+F,EAAOsD,sBAAsBJ,GAElD,GAAInK,EAAKkB,eAAiBlB,EAAKkB,cAAcQ,YAAa,CACxD1B,EAAK2B,wBAA0B,CAAC3B,EAAKkB,cAAcQ,Y,EAErD,MAAOkE,GACP1F,MAAM2F,OAAOC,KAAK,iCAAkCF,EAAE4E,Q,CAIxDxK,EAAKoC,mBAELpC,EAAKyK,QAAU,KAEf,IAAKzK,EAAK+F,mBAAoB,CAC5B7F,MAAM2F,OAAOC,KAAK,6CAAA1B,OAA6CpE,EAAKqD,YAAW,MAC/E,M,CAEF,GAAIrD,EAAKiC,kBAAmB,CAC1B,M,CAIF,GAAIjC,EAAKqD,cAAgB,OAAQ,CAC/B,IAAKrD,EAAK0F,iBAAiBP,OAAQ,CACjCnF,EAAKyC,gBAAkB,KACvB,M,CAEFiI,YAAW,WACT1K,EAAK0F,iBAAiBkC,KAAI,SAAArB,GAAW,OAAAvG,EAAKqC,QAAQsI,OAAO3K,EAAKsG,YAAYC,GAArC,G,IAEvC,M,CAIF,GAAIvG,EAAKqD,cAAgB,aAAerD,EAAK0F,iBAAiBP,OAAQ,CACpEnF,EAAKyC,gBAAkB,KACvB,M,CAGF,OAAOzC,EAAKwC,gB,KAIR1C,EAAAY,UAAA8B,eAAA,eAAAxC,EAAAC,KACNA,KAAK+F,UACLiB,EAAO2D,cAAc3K,KAAKoD,YAAapD,KAAKyF,iBAAkBzF,KAAKoE,OAAOwG,MAAK,SAAAC,GAC7E,IAAKA,EAAIxD,KAAKnC,OAAQ,CACpBnF,EAAKyC,gBAAkB,KACvBzC,EAAK0C,mBAAqB1C,EAAK0C,kBAAkB6G,SACjDvJ,EAAKgG,QAAQ,OACb,M,CAEF0E,YAAW,WACT1K,EAAKyJ,eAAeqB,GAAKjG,SAAQ,SAAAkG,GAAQ,OAAA/K,EAAKqC,QAAQsI,OAAOI,EAApB,G,GACxC,I,KAICjL,EAAAY,UAAAsK,UAAA,WACN,OAAO/K,KAAK8F,oBAAsB9F,KAAKwK,O,EAGzC3K,EAAAY,UAAAuK,OAAA,eAAAjL,EAAAC,KACE,IAAKA,KAAK+K,YAAa,CACrB,MAAO,E,CAGT,GAAI/K,KAAKwC,gBAAiB,CACxB,OAAOyI,EAAA,OAAKC,MAAM,+BAChBD,EAAA,QAAM5I,UAAW8I,IACjBF,EAAA,SAAIjL,KAAKM,iB,CAGb,OACE2K,EAACG,EAAI,CAACF,MAAM,mBACVD,EAAA,OAAKC,MAAO,CACV,0BAA2B,KAC3B,mCAAoClL,KAAK8G,kBAAoB9G,KAAKiD,eAClE,kCAAmCjD,KAAK8G,kBAAoB9G,KAAKiD,eACjE,kCAAmCjD,KAAKiD,gBAExCoI,IAAK,SAAAjJ,GAAW,OAAArC,EAAKqC,QAAUA,CAAf,IAClB6I,EAAA,OAAKC,MAAM,2BAA2BG,IAAK,SAAA3B,GAAU,OAAA3J,EAAK2J,OAASA,CAAd,GACnDuB,EAAA,KAAGC,MAAM,wDAAyDlL,KAAKO,WACvE0K,EAAA,KAAGC,MAAM,0DAA0DlL,KAAKQ,iBAG1EyK,EAAA,OAAKC,MAAM,kCAAkCpJ,MAAO,CAAEC,QAAW,QAAUsJ,IAAK,SAAAlF,GAAU,OAAApG,EAAKoG,OAASA,CAAd,GAAsB8E,EAAA,QAAMC,MAAM,yEAE3HlL,KAAKgC,mBAAqBhC,KAAKgE,WAAahE,KAAK4B,SAChDqJ,EAAA,OAAKC,MAAM,4BAA4BpJ,MAAO,CAAEC,QAAW,QAAUsJ,IAAK,SAAAxJ,GAAmB,OAAA9B,EAAK8B,gBAAkBA,CAAvB,GAC3FoJ,EAAA,UAAQK,QAAS,WAAM,OAAAvL,EAAK+J,UAAL,EAAiBoB,MAAM,uDAC5CD,EAAA,QAAMC,MAAM,4CAA4ClL,KAAKuL,aAAevL,KAAKuL,aAAetL,MAAMC,KAAKC,IAAI,8BAC/G8K,EAAA,QAAMC,MAAM,sEAAsEG,IAAK,SAAAnF,GAAa,OAAAnG,EAAKmG,UAAYA,CAAjB,EAA4BpE,MAAO,CAAEC,QAAW,YAGtJ,G,EAKVlC,EAAAY,UAAA+K,iBAAA,WACExL,KAAKgC,mBAAqBhC,KAAKsC,M,EAGzBzC,EAAAY,UAAA6B,KAAA,WACNtC,KAAK4I,yBACL5I,KAAK+F,S,EAGClG,EAAAY,UAAA+I,eAAA,SAAeJ,GAAf,IAAArJ,EAAAC,K,gBACN,IAAI+D,EAAS/D,KAAKoD,YAClB,IAAIqI,EAAQ,GAEZ,KAAIvC,EAAAE,EAASsC,UAAM,MAAAxC,SAAA,SAAAA,EAAEyC,WAAY,EAAG,CAClCF,EAAQzE,EAAO4E,sBAAsB7H,GACrC,IACE,GAAI/D,KAAKoD,cAAgB,SAAU,CACjCqI,EAAQxL,MAAMC,KAAKC,IAAI,+BAAgC,CAAE0L,KAAQ7L,KAAKyF,kB,MACjE,IAAKgG,EAAO,CACjB,IAAIK,EAAQ9L,KAAKiB,cAAcQ,aAAezB,KAAKyF,iBAAiB,GAEpEgG,IAAQM,GAAAtC,GAAAN,EAAAC,EAASvI,QAAQmL,MAAK,SAAAC,GAAU,OAAAA,EAAO3H,KAAO,aAAd,OAA4B,MAAA6E,SAAA,SAAAA,EAAE+C,UAAM,MAAAzC,SAAA,SAAAA,EAAEuC,MAAK,SAAAG,GAAO,OAAAA,EAAI7H,KAAOwH,CAAX,OAAiB,MAAAC,SAAA,SAAAA,EAAExH,QAAS,E,CAExHkH,IAAUA,EAAQ,MAAQ,IAAMxL,MAAMC,KAAKkM,OAAO,gCAAgCC,EAAAjD,EAAS/B,QAAI,MAAAgF,SAAA,SAAAA,EAAEnH,QACjG,GAAIkE,EAAS/B,KAAKnC,SAAW,GAAI,CAC/BuG,EAAQA,EAAMa,QAAQlD,EAAS/B,KAAKnC,OAAQjF,MAAMC,KAAKC,IAAI,6BAA+B,IAAMiJ,EAAS/B,KAAKnC,O,CAEhHkE,EAASqC,MAAQA,C,CACjB,MAAO9F,GAAG,C,CAGd1F,MAAMU,MAAM4L,KAAK,wCAAyCnD,GAC1DpJ,KAAKwM,gBAAgBD,KAAKnD,GAE1B,GAAIA,EAASvI,SAAWb,KAAKgD,eAAgB,CAC3ChD,KAAKiD,eAAiB,KACtBhD,MAAMU,MAAM4L,KAAK,mBAAoB,CAAE1L,QAASuI,EAASvI,S,MACpD,GAAIb,KAAKgD,eAAgB,CAC9B/C,MAAMU,MAAM4L,KAAK,kB,CAEnBvM,KAAKgE,SAAWoF,EAASsC,OAAStC,EAASsC,OAAOe,KAAOzM,KAAKgE,SAC9DhE,KAAK+F,QAAQ,OACb/F,KAAKyC,mBAAqBzC,KAAKyC,kBAAkB6G,SACjD,GAAItJ,KAAKgC,oBAAsBhC,KAAKgE,SAAU,CAC5ChE,KAAKiC,eAAeyK,OAAO,CAAE1D,gBAAiB,MAAOC,aAAc,QACnEjJ,KAAK0J,OAAOC,cAAc,2BAA2B/G,UAAU0G,OAAO,W,CAExE,QAAOqD,EAAAvD,EAAS/B,QAAI,MAAAsF,SAAA,SAAAA,EAAEhF,KAAI,SAAArB,GAAW,OAAAvG,EAAKsG,YAAYC,EAAjB,MAA8B,E,yHArgBzC,I"}